#!/bin/bash

hn=$(hostname)
hn=${hn%%.*}

hp=$(grep "^${hn}:" ~/etc/hosts_to_ports)
hp=${hp##*:}

MY_REMOTE_RAILS_PORT=2347

ssh -M -N -f \
  -L 127.0.0.1:4000:127.0.0.1:2347 \
  -L 127.0.0.1:8010:127.0.0.1:7010 \
  -L 127.0.0.1:8011:127.0.0.1:7011 \
  -L 127.0.0.1:8012:127.0.0.1:7012 \
  -L 127.0.0.1:8013:127.0.0.1:7013 \
  -L 127.0.0.1:8014:127.0.0.1:7014 \
  -L 127.0.0.1:8015:127.0.0.1:7015 \
  -R 127.0.0.1:$hp:127.0.0.1:22 \
  -R 127.0.0.1:$MY_REMOTE_RAILS_PORT:127.0.0.1:3000 \
  ut.eclipsing.com
